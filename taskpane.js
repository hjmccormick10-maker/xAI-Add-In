/*! For license information please see taskpane.js.LICENSE.txt */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var o in n)("object"==typeof exports?exports:e)[o]=n[o]}}(self,()=>(()=>{"use strict";var e={};function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,a,r,s,i=[],c=!0,l=!1;try{if(r=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(o=r.call(n)).done)&&(i.push(o.value),i.length!==t);c=!0);}catch(e){l=!0,a=e}finally{try{if(!c&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(l)throw a}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,o)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach(function(t){s(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function s(e,n,o){return(n=function(e){var n=function(e){if("object"!=t(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,"string");if("object"!=t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(n)?n:n+""}(n))in e?Object.defineProperty(e,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[n]=o,e}function i(){var e,t,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",a=n.toStringTag||"@@toStringTag";function r(n,o,a,r){var i=o&&o.prototype instanceof l?o:l,u=Object.create(i.prototype);return c(u,"_invoke",function(n,o,a){var r,i,c,l=0,u=a||[],d=!1,m={p:0,n:0,v:e,a:y,f:y.bind(e,4),d:function(t,n){return r=t,i=0,c=e,m.n=n,s}};function y(n,o){for(i=n,c=o,t=0;!d&&l&&!a&&t<u.length;t++){var a,r=u[t],y=m.p,g=r[2];n>3?(a=g===o)&&(c=r[(i=r[4])?5:(i=3,3)],r[4]=r[5]=e):r[0]<=y&&((a=n<2&&y<r[1])?(i=0,m.v=o,m.n=r[1]):y<g&&(a=n<3||r[0]>o||o>g)&&(r[4]=n,r[5]=o,m.n=g,i=0))}if(a||n>1)return s;throw d=!0,o}return function(a,u,g){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&y(u,g),i=u,c=g;(t=i<2?e:c)||!d;){r||(i?i<3?(i>1&&(m.n=-1),y(i,c)):m.n=c:m.v=c);try{if(l=2,r){if(i||(a="next"),t=r[a]){if(!(t=t.call(r,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,i<2&&(i=0)}else 1===i&&(t=r.return)&&t.call(r),i<2&&(c=TypeError("The iterator does not provide a '"+a+"' method"),i=1);r=e}else if((t=(d=m.n<0)?c:n.call(o,m))!==s)break}catch(t){r=e,i=1,c=t}finally{l=1}}return{value:t,done:d}}}(n,a,r),!0),u}var s={};function l(){}function u(){}function d(){}t=Object.getPrototypeOf;var m=[][o]?t(t([][o]())):(c(t={},o,function(){return this}),t),y=d.prototype=l.prototype=Object.create(m);function g(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,c(e,a,"GeneratorFunction")),e.prototype=Object.create(y),e}return u.prototype=d,c(y,"constructor",d),c(d,"constructor",u),u.displayName="GeneratorFunction",c(d,a,"GeneratorFunction"),c(y),c(y,a,"Generator"),c(y,o,function(){return this}),c(y,"toString",function(){return"[object Generator]"}),(i=function(){return{w:r,m:g}})()}function c(e,t,n,o){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}c=function(e,t,n,o){function r(t,n){c(e,t,function(e){return this._invoke(t,n,e)})}t?a?a(e,t,{value:n,enumerable:!o,configurable:!o,writable:!o}):e[t]=n:(r("next",0),r("throw",1),r("return",2))},c(e,t,n,o)}function l(e,t,n,o,a,r,s){try{var i=e[r](s),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(o,a)}function u(e){return function(){var t=this,n=arguments;return new Promise(function(o,a){var r=e.apply(t,n);function s(e){l(r,o,a,s,i,"next",e)}function i(e){l(r,o,a,s,i,"throw",e)}s(void 0)})}}function d(e,t){var n;return function(){for(var o=arguments.length,a=new Array(o),r=0;r<o;r++)a[r]=arguments[r];return new Promise(function(o,r){clearTimeout(n),n=setTimeout(function(){clearTimeout(n);try{var t=e.apply(void 0,a);o(t)}catch(e){r(e)}},t)})}}(e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})})(e),console.log("DEBUG: taskpane.js loaded at "+(new Date).toISOString());var m=!1,y=!1,g=!1,f=null,p="You are a concise assistant for proposal writing in a Word add-in.",v="",h="Normal";if(window.__xaiAddInInitialized)console.log("DEBUG: Skipped taskpane.js initialization - already initialized");else{var I=function(e){return e&&"string"==typeof e?e.replace(/\\n\\r/g,"\r\n").replace(/\\n/g,"\r\n").replace(/\\r/g,"\r\n").replace(/\\\\n/g,"\r\n").replace(/\n/g,"\r\n").replace(/\\t/g,"\t").replace(/\\\\/g,"\\").replace(/\\&/g,"&").replace(/\\\*/g,"*").replace(/\*\*(.*?)\*\*/g,"$1").replace(/\*(.*?)\*/g,"$1").replace(/^#+\s*(.*?)$/gm,"$1").replace(/^\s*[-*]\s*(.*?)$/gm,"$1").replace(/\\[^nr&t*]/g,"").trim():""},E=function(){if(!window.__xaiAddInInitialized||!Office.context){console.log("isInitializedCheck: Office not initialized yet");var e=document.getElementById("statusMessage");return e&&(e.textContent="Office is not initialized. Please wait and try again."),!1}return!0},b=function(){var e=[document.getElementById("enterApiKeyButton"),document.getElementById("enterModelButton"),document.getElementById("configureChatButton")];e.forEach(function(e){e&&"block"!==e.style.display&&(e.style.display="block",console.log("ensureButtonVisibility: Set ".concat(e.id," to display: block")))}),setTimeout(function(){e.forEach(function(e){e&&"block"!==e.style.display&&(console.warn("ensureButtonVisibility: ".concat(e.id," was hidden, forcing display: block")),e.style.display="block")});var t=document.getElementById("responseBox");t&&"block"!==t.style.display&&(console.warn("ensureButtonVisibility: responseBox was hidden, forcing display: block"),t.style.display="block")},1e3)},B=function(){var e=u(i().m(function e(){var t,n,o,a,r,s,c,l,d,y,g,E,B,k;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t="checkConfigOnLoad_".concat(Date.now()),console.time(t),n=document.getElementById("statusMessage"),o=document.getElementById("apiKeyModal"),a=document.getElementById("modelModal"),r=document.getElementById("styleInput"),n&&o&&a&&r){e.n=1;break}return console.error("checkConfigOnLoad: Missing DOM elements"),n&&(n.textContent="Error: UI elements missing."),console.timeEnd(t),e.a(2);case 1:return e.p=1,s="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname,c=s?"http://localhost:3001/get-config":"xai_config.json",e.n=2,fetch(c,{method:"GET",headers:{"Content-Type":"application/json"},mode:"cors"});case 2:if((l=e.v).ok){e.n=3;break}throw new Error("Failed to fetch config, status: ".concat(l.status));case 3:return e.n=4,l.json();case 4:if(d=e.v,console.log("checkConfigOnLoad: Config received",d),y=null,s?m=d.hasValidApiKey||!1:(y=Office.context.roamingSettings.get("xaiApiKey"),m=!!y&&y.startsWith("xai-")&&y.length>=20),document.getElementsByName("tokenLimit").forEach(function(e){e.checked=parseInt(e.value)===(d.XAI_MAX_TOKENS||1e3)}),d.XAI_MODEL?(f=d.XAI_MODEL,localStorage.setItem("xaiModelVersion",f),document.getElementById("modelName").textContent=f,document.getElementById("modelInput").value=f):(console.log("checkConfigOnLoad: No model in config"),f=null,document.getElementById("modelName").textContent="unknown",n.textContent="No model configured. Please select a model.",a.style.display="block",null===(g=document.getElementById("modelInput"))||void 0===g||g.focus()),p=d.XAI_SYSTEM_PROMPT||p,localStorage.setItem("xaiSystemPrompt",p),document.getElementById("systemPromptInput").value=p,document.getElementById("userPersona").value=v,!d.XAI_FONT){e.n=10;break}return E=I(d.XAI_FONT).trim(),console.log('checkConfigOnLoad: Validating style "'.concat(E,'" from XAI_FONT')),e.p=5,e.n=6,Word.run(function(){var e=u(i().m(function e(t){var o;return i().w(function(e){for(;;)switch(e.n){case 0:return o=t.document.getStyles(),t.load(o),e.n=1,t.sync();case 1:if(o.items.some(function(e){return e.nameLocal.toLowerCase()===E.toLowerCase()})?(h=o.items.find(function(e){return e.nameLocal.toLowerCase()===E.toLowerCase()}).nameLocal,r.value=h,localStorage.setItem("xaiStyle",h),s||Office.context.roamingSettings.set("xaiStyle",h),console.log('checkConfigOnLoad: Set style to "'.concat(h,'" from XAI_FONT'))):(console.warn('checkConfigOnLoad: Invalid style "'.concat(E,'" in XAI_FONT')),h="Normal",r.value=h,localStorage.setItem("xaiStyle",h),s||Office.context.roamingSettings.set("xaiStyle",h),n.textContent="Invalid style in configuration. Defaulted to 'Normal'."),s){e.n=2;break}return e.n=2,Office.context.roamingSettings.saveAsync();case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 6:e.n=9;break;case 7:if(e.p=7,B=e.v,console.error('checkConfigOnLoad: Error validating style "'.concat(E,'"'),B.message),h="Normal",r.value=h,localStorage.setItem("xaiStyle",h),s){e.n=8;break}return Office.context.roamingSettings.set("xaiStyle",h),e.n=8,Office.context.roamingSettings.saveAsync();case 8:n.textContent="Error validating style: ".concat(B.message,". Defaulted to 'Normal'.");case 9:e.n=12;break;case 10:if(console.log("checkConfigOnLoad: No style in config (XAI_FONT missing)"),h="Normal",r.value=h,localStorage.setItem("xaiStyle",h),s){e.n=11;break}return Office.context.roamingSettings.set("xaiStyle",h),e.n=11,Office.context.roamingSettings.saveAsync();case 11:n.textContent="No style configured. Defaulted to 'Normal'.";case 12:m?(console.log("checkConfigOnLoad: Valid API key found"),localStorage.setItem("xaiApiKey","[REDACTED]"),n.textContent="API key loaded successfully."):(console.log("checkConfigOnLoad: No valid API key"),localStorage.removeItem("xaiApiKey"),n.textContent="No valid API key found. Please enter a key.",o.style.display="block",o.focus()),m&&f&&h&&(n.textContent="Ready to submit questions."),e.n=14;break;case 13:e.p=13,k=e.v,console.error("checkConfigOnLoad: Error",k.message),localStorage.removeItem("xaiApiKey"),localStorage.removeItem("xaiModelVersion"),localStorage.removeItem("xaiSystemPrompt"),localStorage.removeItem("xaiPersona"),localStorage.removeItem("xaiStyle"),m=!1,f=null,h="Normal",r.value=h,document.getElementById("modelName").textContent="unknown",n.textContent="Error loading configuration: ".concat(k.message,". Please enter an API key, model, and style."),o.style.display="block",o.focus();case 14:return e.p=14,console.timeEnd(t),b(),e.f(14);case 15:return e.a(2)}},e,null,[[5,7],[1,13,14,15]])}));return function(){return e.apply(this,arguments)}}(),k=function(){console.log("cancelChatConfig: Starting");var e=document.getElementById("chatConfigModal"),t=document.getElementById("systemPromptInput"),n=document.getElementById("userPersona"),o=document.getElementById("userMessageInput"),a=document.getElementById("statusMessage");if(!e)return console.error("cancelChatConfig: chatConfigModal not found in DOM"),void(a.textContent="Error: Chat configuration UI missing.");e.style.display="none",t&&(t.value=p),n&&(n.value=v),o&&(o.value=""),a.textContent="Chat configuration cancelled.",b()},S=function(){var e=document.getElementById("questionBox"),t=document.getElementById("statusMessage"),n=document.getElementById("tokenDisplay");e&&(e.value=""),t&&(t.textContent="Question and response cleared."),n&&(n.style.display="none"),console.log("cancelQuestion: Question discarded")},x=function(){var e=document.getElementById("responseBox"),t=document.getElementById("tokenDisplay"),n=document.getElementById("statusMessage");e&&(e.value="",e.style.height="auto"),t&&(t.style.display="none"),n&&(n.textContent="Response discarded."),console.log("discardResponse: Response discarded")},C=function(){var e=document.getElementById("apiKeyInput"),t=document.getElementById("showApiKeyCheckbox");e&&t&&(e.type=t.checked?"text":"password")},w=function(){var e=u(i().m(function e(){var t,n,o;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if(console.log("insertResponse: Starting"),E()){e.n=1;break}return e.a(2);case 1:if(t=document.getElementById("responseBox"),n=document.getElementById("statusMessage"),t){e.n=2;break}return console.error("insertResponse: Missing DOM elements",{responseBox:t}),n&&(n.textContent="Error: UI elements missing."),e.a(2);case 2:if(t.value){e.n=3;break}return console.log("insertResponse: No response to insert"),n&&(n.textContent="No response to insert."),e.a(2);case 3:return e.p=3,e.n=4,Word.run(function(){var e=u(i().m(function e(o){var a,r,s,c,l,u,d,m,y;return i().w(function(e){for(;;)switch(e.n){case 0:return a=o.document,r=a.getStyles(),s=a.getSelection(),o.load(r),o.load(s),e.n=1,o.sync();case 1:for(console.log("insertResponse: Available styles =",r.items.map(function(e){return e.nameLocal})),c=h,console.log("insertResponse: Using style =",c),l=I(t.value),u=l.split("\r\n").filter(function(e){return e.trim()}),d=u.length-1;d>=0;d--){m=u[d],console.log("insertResponse: Preparing paragraph ".concat(d+1,":"),m),y=s.insertParagraph(m,Word.InsertLocation.after);try{y.style=c}catch(e){console.log("insertResponse: Failed to apply style ".concat(c,": ").concat(e.message)),y.style="Normal",y.font.name="Arial",y.font.size=11,y.font.color="#1A3C5A"}"Normal"===c&&(y.font.name="Arial",y.font.size=11,y.font.color="#1A3C5A"),m.match(/\*\*(.*?)\*\*/)&&(y.font.bold=!0),m.match(/^\s*[-*]\s*(.*?)$/)&&(y.leftIndent=20),(m.match(/^[A-Za-z\s]+:$/)||m.match(/^#+\s*(.*?)$/))&&(y.font.size=14,y.font.bold=!0,y.spaceAfter=6),y.spaceAfter=6}return e.n=2,o.sync();case 2:console.log("insertResponse: All paragraphs inserted"),n&&(n.textContent="Response inserted.");case 3:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 4:e.n=6;break;case 5:e.p=5,o=e.v,console.error("insertResponse: Error",o.message,o.stack),n&&(n.textContent="Error inserting response: ".concat(o.message));case 6:return e.p=6,b(),e.f(6);case 7:return e.a(2)}},e,null,[[3,5,6,7]])}));return function(){return e.apply(this,arguments)}}(),O=function(){var e=u(i().m(function e(){var t,n,o,a,r,s;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if(console.log("insertSnippet: Starting"),E()){e.n=1;break}return e.a(2);case 1:if(t=document.getElementById("responseBox"),n=document.getElementById("statusMessage"),t){e.n=2;break}return console.error("insertSnippet: Missing DOM elements",{responseBox:t}),n&&(n.textContent="Error: UI elements missing."),e.a(2);case 2:if(o=t.selectionStart,a=t.selectionEnd,r=I(t.value.substring(o,a)||"")){e.n=3;break}return console.log("insertSnippet: No text selected"),n&&(n.textContent="Please select text to insert."),e.a(2);case 3:return e.p=3,e.n=4,Word.run(function(){var e=u(i().m(function e(t){var o,a,s,c,l,u,d,m;return i().w(function(e){for(;;)switch(e.n){case 0:return o=t.document,a=o.getStyles(),s=o.getSelection(),t.load(a),t.load(s),e.n=1,t.sync();case 1:for(console.log("insertSnippet: Available styles =",a.items.map(function(e){return e.nameLocal})),c=h,l=r.split("\r\n").filter(function(e){return e.trim()}),u=l.length-1;u>=0;u--){d=l[u],console.log("insertSnippet: Preparing paragraph ".concat(u+1,":"),d),m=s.insertParagraph(d,Word.InsertLocation.after);try{m.style=c}catch(e){console.log("insertSnippet: Failed to apply style ".concat(c,": ").concat(e.message)),m.style="Normal",m.font.name="Arial",m.font.size=11,m.font.color="#1A3C5A"}"Normal"===c&&(m.font.name="Arial",m.font.size=11,m.font.color="#1A3C5A"),d.match(/\*\*(.*?)\*\*/)&&(m.font.bold=!0),d.match(/^\s*[-*]\s*(.*?)$/)&&(m.leftIndent=20),(d.match(/^[A-Za-z\s]+:$/)||d.match(/^#+\s*(.*?)$/))&&(m.font.size=14,m.font.bold=!0,m.spaceAfter=6),m.spaceAfter=6}return e.n=2,t.sync();case 2:console.log("insertSnippet: All paragraphs inserted"),n&&(n.textContent="Snippet inserted.");case 3:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 4:t.setSelectionRange(o,a),t.focus(),e.n=6;break;case 5:e.p=5,s=e.v,console.error("insertSnippet: Error",s.message,s.stack),n&&(n.textContent="Error inserting snippet: ".concat(s.message));case 6:return e.p=6,b(),e.f(6);case 7:return e.a(2)}},e,null,[[3,5,6,7]])}));return function(){return e.apply(this,arguments)}}(),A=function(){var e=document.getElementById("styleModal"),t=document.getElementById("styleModalInput"),n=document.getElementById("statusMessage");if(!e||!t)return console.error("cancelStyle: Missing DOM elements"),void(n.textContent="Error: Style input UI missing.");t.value=h,e.style.display="none",n.textContent="Style change cancelled.",console.log("cancelStyle: Style change cancelled")},M=function(e){"Enter"!==e.key||e.shiftKey||y||(e.preventDefault(),console.log("handleQuestionBoxKeydown: Enter key pressed, triggering submitQuestion"),K())};window.__xaiAddInInitialized=!0;var P=d(u(i().m(function e(){var t,n,o,a,r,s;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=document.getElementById("modelInput"),n=document.getElementById("statusMessage"),o=document.getElementById("modelModal"),t&&n&&o){e.n=1;break}return console.error("saveModel: Missing DOM elements"),n.textContent="Error: Model input UI missing.",e.a(2);case 1:if(a=I(t.value)){e.n=2;break}return console.log("saveModel: No model entered"),n.textContent="Please enter a model name.",e.a(2);case 2:if(e.p=2,"localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname){e.n=5;break}return e.n=3,fetch("http://localhost:3001/save-env",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:a}),mode:"cors"});case 3:if((r=e.v).ok){e.n=4;break}throw new Error("Failed to save model, status: ".concat(r.status));case 4:e.n=6;break;case 5:return Office.context.roamingSettings.set("xaiModelVersion",a),e.n=6,Office.context.roamingSettings.saveAsync();case 6:f=a,localStorage.setItem("xaiModelVersion",a),document.getElementById("modelName").textContent=a,document.getElementById("modelInput").value=a,n.textContent="Model updated successfully.",o.style.display="none",console.log('saveModel: Set model to "'.concat(a,'"')),e.n=8;break;case 7:e.p=7,s=e.v,console.error("saveModel: Error",s.message),n.textContent="Error saving model: ".concat(s.message);case 8:return e.p=8,b(),e.f(8);case 9:return e.a(2)}},e,null,[[2,7,8,9]])})),500),L=d(u(i().m(function e(){var t,n,o,a,r;return i().w(function(e){for(;;)switch(e.n){case 0:if(console.log("configureChat: Starting"),t=document.getElementById("systemPromptInput"),n=document.getElementById("userPersona"),o=document.getElementById("userMessageInput"),a=document.getElementById("statusMessage"),r=document.getElementById("chatConfigModal"),t&&n&&o&&a&&r){e.n=1;break}return console.error("configureChat: Missing DOM elements"),a.textContent="Error: Chat configuration UI missing.",e.a(2);case 1:t.value=p||"",n.value=v||"",o.value="",r.style.display="block",t.focus();case 2:return e.a(2)}},e)})),500),N=d(u(i().m(function e(){var t,n,o,a,r,s,c,l,u,d,m;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if(console.log("saveChatConfig: Starting"),t=document.getElementById("systemPromptInput"),n=document.getElementById("userPersona"),o=document.getElementById("userMessageInput"),a=document.getElementById("statusMessage"),r=document.getElementById("chatConfigModal"),t&&n&&o&&a&&r){e.n=1;break}return console.error("saveChatConfig: Missing DOM elements"),a.textContent="Error: Chat configuration UI missing.",e.a(2);case 1:if(s=I(t.value),c=I(n.value),l=I(o.value),s){e.n=2;break}return console.log("saveChatConfig: No system prompt entered"),a.textContent="Please enter a system prompt.",t.focus(),e.a(2);case 2:if(!(c.length>50)){e.n=3;break}return console.log("saveChatConfig: Persona too long"),a.textContent="Persona must be 50 characters or less.",n.focus(),e.a(2);case 3:if(e.p=3,"localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname){e.n=6;break}return e.n=4,fetch("http://localhost:3001/save-env",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({systemPrompt:s}),mode:"cors"});case 4:if((u=e.v).ok){e.n=5;break}throw new Error("Failed to save chat config, status: ".concat(u.status));case 5:e.n=7;break;case 6:return Office.context.roamingSettings.set("xaiSystemPrompt",s),Office.context.roamingSettings.set("xaiPersona",c),e.n=7,Office.context.roamingSettings.saveAsync();case 7:p=s,localStorage.setItem("xaiSystemPrompt",s),v=c,localStorage.setItem("xaiPersona",c),(d=document.getElementById("questionBox"))&&(d.value=c&&l?"As a ".concat(c,": ").concat(l):l||""),a.textContent="Chat configuration saved successfully.",r.style.display="none",console.log('saveChatConfig: Set system prompt to "'.concat(s,'", persona to "').concat(c,'"')),e.n=9;break;case 8:e.p=8,m=e.v,console.error("saveChatConfig: Error",m.message),a.textContent="Error saving chat configuration: ".concat(m.message),t.value=p,n.value=v,o.value="";case 9:return e.p=9,b(),e.f(9);case 10:return e.a(2)}},e,null,[[3,8,9,10]])})),500),j=d(u(i().m(function e(){var t,n,o,a,r,s,c,l,u;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=document.getElementById("apiKeyInput"),n=document.getElementById("statusMessage"),o=document.getElementById("apiKeyModal"),t&&n&&o){e.n=1;break}return console.error("saveApiKey: Missing DOM elements"),n.textContent="Error: API key input UI missing.",e.a(2);case 1:if((a=t.value.trim())&&a.startsWith("xai-")&&!(a.length<20)&&/^[a-zA-Z0-9-]+$/.test(a)){e.n=2;break}return console.log("saveApiKey: Invalid API key format"),m=!1,n.textContent="Invalid API key format. Must start with 'xai-' and be at least 20 characters.",t.focus(),e.a(2);case 2:if(e.p=2,"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname){e.n=7;break}return e.n=3,fetch("https://api.x.ai/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify({messages:[{role:"user",content:"Test"}],model:"grok-3",max_tokens:10}),mode:"cors"});case 3:if((r=e.v).ok){e.n=5;break}return e.n=4,r.json();case 4:throw s=e.v,new Error(s.error||"API key validation failed");case 5:return Office.context.roamingSettings.set("xaiApiKey",a),e.n=6,Office.context.roamingSettings.saveAsync();case 6:e.n=10;break;case 7:return e.n=8,fetch("http://localhost:3001/save-env",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:a}),mode:"cors"});case 8:if((c=e.v).ok){e.n=10;break}return e.n=9,c.json();case 9:throw l=e.v,new Error(l.error||"Failed to save API key to server");case 10:localStorage.setItem("xaiApiKey","[REDACTED]"),m=!0,n.textContent="API key saved and validated successfully.",o.style.display="none",console.log("saveApiKey: API key saved"),e.n=12;break;case 11:e.p=11,u=e.v,console.error("saveApiKey: Error",u.message),m=!1,n.textContent="Error saving API key: ".concat(u.message),t.focus();case 12:return e.p=12,b(),e.f(12);case 13:return e.a(2)}},e,null,[[2,11,12,13]])})),500),T=d(u(i().m(function e(){var t,n,o,a,r,s;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=document.getElementById("styleModalInput"),n=document.getElementById("styleInput"),o=document.getElementById("statusMessage"),a=document.getElementById("styleModal"),t&&n&&o&&a){e.n=1;break}return console.error("saveStyle: Missing DOM elements"),o.textContent="Error: Style input UI missing.",e.a(2);case 1:if(r=I(t.value).trim()){e.n=2;break}return console.log("saveStyle: No style entered"),o.textContent="Please enter a style name.",t.focus(),e.a(2);case 2:return e.p=2,e.n=3,Word.run(function(){var e=u(i().m(function e(t){var s,c;return i().w(function(e){for(;;)switch(e.n){case 0:return s=t.document.getStyles(),t.load(s),e.n=1,t.sync();case 1:if(s.items.some(function(e){return e.nameLocal.toLowerCase()===r.toLowerCase()})){e.n=2;break}console.warn("saveStyle: Style not found",r),o.textContent="Style is not available.",h="Normal",n.value=h,localStorage.setItem("xaiStyle",h),e.n=7;break;case 2:if(h=s.items.find(function(e){return e.nameLocal.toLowerCase()===r.toLowerCase()}).nameLocal,n.value=h,localStorage.setItem("xaiStyle",h),"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname){e.n=4;break}return Office.context.roamingSettings.set("xaiStyle",h),e.n=3,Office.context.roamingSettings.saveAsync();case 3:e.n=6;break;case 4:return e.n=5,fetch("http://localhost:3001/save-env",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({font:h}),mode:"cors"});case 5:if((c=e.v).ok){e.n=6;break}throw new Error("Failed to save style, status: ".concat(c.status));case 6:o.textContent='Style set to "'.concat(h,'".');case 7:a.style.display="none",console.log('saveStyle: Set style to "'.concat(h,'"'));case 8:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 3:e.n=6;break;case 4:if(e.p=4,s=e.v,console.error("saveStyle: Error",s.message),o.textContent="Error saving style: ".concat(s.message,". Defaulted to 'Normal'."),h="Normal",n.value=h,localStorage.setItem("xaiStyle",h),isLocal){e.n=5;break}return Office.context.roamingSettings.set("xaiStyle",h),e.n=5,Office.context.roamingSettings.saveAsync();case 5:a.style.display="none";case 6:return e.a(2)}},e,null,[[2,4]])})),500),K=d(u(i().m(function e(){var t,n,o,a,s,c,l,u,d,g,h,E,B,k,S,x,C,w,O,A;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!y){e.n=1;break}return console.log("submitQuestion: Submission debounced, already in progress"),e.a(2);case 1:if(y=!0,n="submitQuestion_".concat(Date.now()),console.time(n),o=document.getElementById("questionBox"),a=document.getElementById("statusMessage"),s=document.getElementById("apiKeyModal"),c=document.getElementById("modelModal"),(l=document.getElementById("submitButton"))&&(l.disabled=!0,l.textContent="Submitting..."),u=I((null==o?void 0:o.value)||""),d=parseInt((null===(t=document.querySelector('input[name="tokenLimit"]:checked'))||void 0===t?void 0:t.value)||1e3),u){e.n=2;break}return console.log("submitQuestion: No question entered"),a.textContent="Please enter a question.",y=!1,l&&(l.disabled=!1,l.textContent="Submit Question"),console.timeEnd(n),e.a(2);case 2:if(m){e.n=3;break}return console.log("submitQuestion: No valid API key"),a.textContent="Please enter a valid API key.",s.style.display="block",s.focus(),y=!1,l&&(l.disabled=!1,l.textContent="Submit Question"),console.timeEnd(n),e.a(2);case 3:if(f){e.n=4;break}return console.log("submitQuestion: No valid model selected"),a.textContent="Please select a valid model.",c.style.display="block",null===(g=document.getElementById("modelInput"))||void 0===g||g.focus(),y=!1,l&&(l.disabled=!1,l.textContent="Submit Question"),console.timeEnd(n),e.a(2);case 4:return e.p=4,h="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname,E=null,h||(E=Office.context.roamingSettings.get("xaiApiKey")),a.textContent="Submitting question...",B=v&&u&&!u.startsWith("As a ".concat(v,": "))?"As a ".concat(v,": ").concat(u):u,e.n=5,fetch(h?"http://localhost:3001/api/chat":"https://api.x.ai/v1/chat/completions",{method:"POST",headers:r({"Content-Type":"application/json"},h?{}:{Authorization:"Bearer ".concat(E)}),body:JSON.stringify({messages:[{role:"system",content:p},{role:"user",content:B}],model:f,max_tokens:d}),mode:"cors"});case 5:if((k=e.v).ok){e.n=7;break}return e.n=6,k.json();case 6:throw S=e.v,new Error(S.error||"HTTP error, status: ".concat(k.status));case 7:return e.n=8,k.json();case 8:x=e.v,(C=document.getElementById("responseBox"))&&(C.value=I((null===(w=x.choices)||void 0===w||null===(w=w[0])||void 0===w||null===(w=w.message)||void 0===w?void 0:w.content)||"No response received."),C.style.height="auto",C.style.height="".concat(C.scrollHeight,"px")),O=document.getElementById("tokenDisplay"),x.usage&&O&&(document.getElementById("promptTokens").textContent=x.usage.prompt_tokens||0,document.getElementById("completionTokens").textContent=x.usage.completion_tokens||0,document.getElementById("totalTokens").textContent=x.usage.total_tokens||0,O.style.display="block"),a.textContent="Response received.",e.n=10;break;case 9:e.p=9,A=e.v,console.error("submitQuestion: Error",A.message),a.textContent="Error: ".concat(A.message,". Please check your API key or model."),s.style.display="block",s.focus();case 10:return e.p=10,y=!1,l&&(l.disabled=!1,l.textContent="Submit Question"),console.timeEnd(n),b(),e.f(10);case 11:return e.a(2)}},e,null,[[4,9,10,11]])})),500);Office.onReady(function(){console.log("Office.onReady: Office initialized"),function(){if(g)console.log("DEBUG: Skipped event handler initialization - already initialized");else{g=!0;try{var e={submitButton:document.getElementById("submitButton"),questionBox:document.getElementById("questionBox"),responseBox:document.getElementById("responseBox"),cancelButton:document.getElementById("cancelButton"),enterApiKeyButton:document.getElementById("enterApiKeyButton"),saveApiKeyButton:document.getElementById("saveApiKeyButton"),cancelApiKeyButton:document.getElementById("cancelApiKeyButton"),showApiKeyCheckbox:document.getElementById("showApiKeyCheckbox"),insertButton:document.getElementById("insertButton"),insertSnippetButton:document.getElementById("insertSnippetButton"),discardButton:document.getElementById("discardButton"),enterModelButton:document.getElementById("enterModelButton"),saveModelButton:document.getElementById("saveModelButton"),cancelModelButton:document.getElementById("cancelModelButton"),configureChatButton:document.getElementById("configureChatButton"),saveChatConfigButton:document.getElementById("saveChatConfigButton"),cancelChatConfigButton:document.getElementById("cancelChatConfigButton"),apiKeyModal:document.getElementById("apiKeyModal"),modelModal:document.getElementById("modelModal"),chatConfigModal:document.getElementById("chatConfigModal"),changeStyleButton:document.getElementById("changeStyleButton"),styleModal:document.getElementById("styleModal"),saveStyleButton:document.getElementById("saveStyleButton"),cancelStyleButton:document.getElementById("cancelStyleButton"),modelInput:document.getElementById("modelInput"),styleModalInput:document.getElementById("styleModalInput")},t=Object.entries(e).filter(function(e){var t=n(e,2);return t[0],!t[1]}).map(function(e){return n(e,1)[0]});if(t.length>0){console.error("initializeEventHandlers: Missing DOM elements:",t.join(", "));var o=document.getElementById("statusMessage");return void(o&&(o.textContent="Error: Some UI elements are missing."))}e.submitButton.addEventListener("click",K),e.questionBox.addEventListener("keydown",M),e.cancelButton.addEventListener("click",S),e.discardButton.addEventListener("click",x),e.insertButton.addEventListener("click",w),e.insertSnippetButton.addEventListener("click",O),e.enterApiKeyButton.addEventListener("click",function(){var t;e.apiKeyModal.style.display="block",null===(t=document.getElementById("apiKeyInput"))||void 0===t||t.focus()}),e.saveApiKeyButton.addEventListener("click",j),e.cancelApiKeyButton.addEventListener("click",function(){e.apiKeyModal.style.display="none";var t=document.getElementById("statusMessage");t&&(t.textContent=m?"API key unchanged.":"Please enter a valid API key.")}),e.showApiKeyCheckbox.addEventListener("change",C),e.enterModelButton.addEventListener("click",function(){var t;e.modelModal.style.display="block",null===(t=document.getElementById("modelInput"))||void 0===t||t.focus()}),e.saveModelButton.addEventListener("click",P),e.cancelModelButton.addEventListener("click",function(){e.modelModal.style.display="none";var t=document.getElementById("statusMessage");t&&(t.textContent=f?"Model unchanged.":"Please select a valid model.")}),e.configureChatButton.addEventListener("click",L),e.saveChatConfigButton.addEventListener("click",N),e.cancelChatConfigButton.addEventListener("click",k),e.changeStyleButton.addEventListener("click",function(){e.styleModal.style.display="block";var t=document.getElementById("styleModalInput");t.value=h,t.focus()}),e.saveStyleButton.addEventListener("click",T),e.cancelStyleButton.addEventListener("click",A),e.modelInput.addEventListener("keydown",function(e){"Enter"===e.key&&(e.preventDefault(),P())}),e.styleModalInput.addEventListener("keydown",function(e){"Enter"===e.key&&(e.preventDefault(),T())}),console.log("initializeEventHandlers: Event handlers set up successfully")}catch(e){console.error("initializeEventHandlers: Error setting up event handlers",e.message,e.stack);var a=document.getElementById("statusMessage");a&&(a.textContent="Error initializing UI: ".concat(e.message))}}}(),B()})}return e})());
//# sourceMappingURL=taskpane.js.map